# Telegraf pulls uplinks from TTN MQTT and writes them to InfluxDB.
[global_tags]
  source = "ttn"

[agent]
  interval = "10s"
  flush_interval = "10s"
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  omit_hostname = true
  debug = true
  quiet = false

[[inputs.mqtt_consumer]]
  servers = ["tcp://${TTN_REGION}.cloud.thethings.network:1883"]
  topics = ["v3/${TTN_APP_ID}@ttn/devices/+/up"]
  username = "${TTN_APP_ID}@ttn"
  password = "${TTN_API_KEY}"
  qos = 0
  connection_timeout = "30s"
  data_format = "json"
  name_override = "ttn_uplink"

[[outputs.file]]
  files = ["stdout"]
  data_format = "json"

[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "${INFLUXDB_TOKEN}"
  organization = "${INFLUXDB_ORG}"
  bucket = "${INFLUXDB_BUCKET}"
  timeout = "15s"
